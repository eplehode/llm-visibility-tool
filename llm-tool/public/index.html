<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LLM Visibility Diagnosis Tool - Multi-Page Analysis</title>
  <style>
    /* ==== FULL CSS ==== */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;}
    .container{max-width:1200px;margin:0 auto;}
    .header{text-align:center;color:white;margin-bottom:30px;}
    .header h1{font-size:2.5rem;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,0.2);}
    .header p{font-size:1.1rem;opacity:.95;}
    .input-section{background:white;border-radius:20px;padding:30px;box-shadow:0 20px 40px rgba(0,0,0,0.1);margin-bottom:30px;}
    .input-mode-toggle{display:flex;gap:10px;margin-bottom:20px;background:#f5f5f5;padding:5px;border-radius:10px;}
    .mode-btn{flex:1;padding:10px;background:transparent;border:none;border-radius:8px;cursor:pointer;font-size:1rem;transition:all .3s;}
    .mode-btn.active{background:white;box-shadow:0 2px 10px rgba(0,0,0,0.1);color:#667eea;font-weight:600;}
    .single-input{display:block;}
    .multi-input{display:none;}
    .multi-input.active{display:block;}
    .single-input.active{display:block;}
    .input-group{display:flex;gap:15px;align-items:center;margin-bottom:15px;}
    input[type=text],input[type=url]{flex:1;padding:15px 20px;font-size:1.1rem;border:2px solid #e0e0e0;border-radius:10px;transition:all .3s;}
    input[type=text]:focus,input[type=url]:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1);}
    .page-inputs{background:#f9f9f9;padding:20px;border-radius:10px;margin-bottom:20px;}
    .page-input-group{display:flex;gap:10px;align-items:center;margin-bottom:12px;}
    .page-label{min-width:140px;font-weight:500;color:#555;}
    .page-input-group input{flex:1;padding:10px 15px;font-size:.95rem;}
    .optional-tag{color:#999;font-size:.85rem;font-weight:normal;}
    .analyze-btn{padding:15px 40px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;
      border-radius:10px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all .3s;width:100%;}
    .analyze-btn:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(102,126,234,.3);}
    .analyze-btn:disabled{opacity:.6;cursor:not-allowed;transform:none;}
    .help-text{color:#666;font-size:.9rem;margin-top:10px;padding:10px;background:#f0f0ff;border-radius:8px;}
    .results-section{display:none;}
    .results-section.active{display:block;animation:fadeIn .5s;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
    .results-tabs{background:white;border-radius:20px 20px 0 0;padding:5px;margin-bottom:0;display:flex;gap:5px;overflow-x:auto;}
    .tab-btn{padding:12px 20px;background:transparent;border:none;border-radius:15px;cursor:pointer;font-size:.95rem;white-space:nowrap;transition:all .3s;color:#666;}
    .tab-btn.active{background:linear-gradient(135deg,#667eea,#764ba2);color:white;font-weight:600;}
    .tab-content{background:white;padding:30px;border-radius:0 0 20px 20px;box-shadow:0 20px 40px rgba(0,0,0,0.1);display:none;}
    .tab-content.active{display:block;}
    .comparison-table{width:100%;border-collapse:collapse;margin-top:20px;}
    .comparison-table th{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:15px;text-align:left;font-weight:600;}
    .comparison-table td{padding:12px 15px;border-bottom:1px solid #e0e0e0;}
    .comparison-table tr:hover{background:#f5f5f5;}
    .score-cell{font-weight:bold;text-align:center;}
    .overall-score{background:white;border-radius:20px;padding:40px;text-align:center;margin-bottom:30px;box-shadow:0 20px 40px rgba(0,0,0,0.1);}
    .score-circle{width:200px;height:200px;margin:0 auto 20px;position:relative;}
    .score-circle svg{transform:rotate(-90deg);}
    .score-number{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:3rem;font-weight:bold;color:#333;}
    .score-label{font-size:1.3rem;color:#666;margin-bottom:10px;}
    .score-status{font-size:1.5rem;font-weight:600;margin-top:10px;}
    .factors-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:30px;}
    .factor-card{background:white;border-radius:15px;padding:25px;box-shadow:0 10px 30px rgba(0,0,0,.08);transition:all .3s;}
    .factor-card:hover{transform:translateY(-5px);box-shadow:0 15px 40px rgba(0,0,0,.12);}
    .factor-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;}
    .factor-title{font-size:1.1rem;font-weight:600;color:#333;}
    .factor-score{font-size:1.3rem;font-weight:bold;padding:5px 15px;border-radius:20px;background:#f5f5f5;}
    .factor-details{color:#666;line-height:1.6;margin-bottom:15px;}
    .factor-items{list-style:none;}
    .factor-items li{padding:8px 0;display:flex;align-items:center;gap:10px;}
    .check-icon{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;color:white;}
    .check-icon.pass{background:#4caf50;}
    .check-icon.fail{background:#f44336;}
    .check-icon.partial{background:#ff9800;}
    .recommendations{background:white;border-radius:20px;padding:40px;margin-bottom:30px;box-shadow:0 20px 40px rgba(0,0,0,0.1);}
    .recommendations h2{color:#333;margin-bottom:25px;font-size:1.8rem;}
    .factor-section{margin-bottom:40px;padding:25px;background:#f8f9fa;border-radius:15px;border-left:4px solid #667eea;}
    .factor-section h3{color:#333;margin-bottom:15px;font-size:1.3rem;display:flex;justify-content:space-between;align-items:center;}
    .factor-explanation{background:white;padding:15px;border-radius:10px;margin-bottom:20px;font-size:.95rem;color:#555;line-height:1.6;}
    .recommendation-item{background:white;padding:20px;margin-bottom:15px;border-radius:10px;border-left:3px solid #764ba2;}
    .recommendation-priority{display:inline-block;padding:5px 15px;background:#667eea;color:white;border-radius:20px;font-size:.9rem;margin-bottom:10px;}
    .priority-high{background:#f44336;}
    .priority-medium{background:#ff9800;}
    .priority-low{background:#4caf50;}
    .recommendation-title{font-size:1.1rem;font-weight:600;color:#333;margin-bottom:10px;}
    .recommendation-steps{margin-top:15px;padding-left:20px;}
    .recommendation-steps li{margin-bottom:8px;color:#666;line-height:1.6;}
    .debug-info{background:#f5f5f5;padding:10px;border-radius:5px;font-size:.85rem;margin-top:10px;font-family:monospace;}
    .loading{text-align:center;padding:40px;background:white;border-radius:20px;margin-bottom:30px;}
    .spinner{border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:0 auto 20px;}
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    .error-message{background:#ffebee;color:#c62828;padding:20px;border-radius:10px;margin-bottom:20px;border-left:4px solid #c62828;}
    .progress-bar{width:100%;height:30px;background:#f5f5f5;border-radius:15px;overflow:hidden;margin-top:20px;}
    .progress-fill{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);border-radius:15px;transition:width .5s ease;display:flex;align-items:center;justify-content:center;color:white;font-weight:600;}
    .current-page-indicator{color:#667eea;font-weight:600;margin-top:10px;text-align:center;}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸ¤– LLM Visibility Diagnosis Tool</h1>
      <p>Analyze how well AI assistants can discover, understand, and cite your website</p>
      <p style="font-size:.9rem;opacity:.8;margin-top:5px;">8 Real Factors â€¢ Multi-Page Analysis â€¢ Complete Recommendations</p>
    </div>
    <!-- === INPUT UI (single + multi page) === -->
    <div class="input-section">
      <div class="input-mode-toggle">
        <button class="mode-btn active" onclick="toggleMode('single')">Single Page Analysis</button>
        <button class="mode-btn" onclick="toggleMode('multi')">Multi-Page Analysis</button>
      </div>
      <div class="single-input active">
        <div class="input-group">
          <input type="text" id="domainInput" placeholder="Enter domain or URL (e.g., example.com/blog/article)" />
        </div>
        <button class="analyze-btn" onclick="analyzeSingle()">Analyze Page</button>
      </div>
      <div class="multi-input">
        <div class="input-group">
          <input type="text" id="mainDomainInput" placeholder="Enter main domain (e.g., example.com)" />
        </div>
        <div class="page-inputs">
          <h3 style="margin-bottom:15px;color:#333;">Add specific pages to analyze (optional):</h3>
          <div class="page-input-group"><label class="page-label">Homepage:</label><input type="url" id="homepageUrl" placeholder="Auto-filled from domain"></div>
          <div class="page-input-group"><label class="page-label">Blog/Article:</label><input type="url" id="blogUrl" placeholder="e.g., example.com/blog/best-practices"></div>
          <div class="page-input-group"><label class="page-label">About Us:</label><input type="url" id="aboutUrl" placeholder="e.g., example.com/about"></div>
          <div class="page-input-group"><label class="page-label">Product/Service:</label><input type="url" id="productUrl" placeholder="e.g., example.com/products/main-product"></div>
          <div class="page-input-group"><label class="page-label">Contact:</label><input type="url" id="contactUrl" placeholder="e.g., example.com/contact"></div>
          <div class="page-input-group"><label class="page-label">FAQ:</label><input type="url" id="faqUrl" placeholder="e.g., example.com/faq"></div>
          <div class="page-input-group"><label class="page-label">Custom Page:</label><input type="url" id="customUrl" placeholder="Any other important page"></div>
        </div>
        <button class="analyze-btn" onclick="analyzeMultiple()">Analyze All Pages</button>
        <div class="help-text">ðŸ’¡ <strong>Tip:</strong> Leave fields empty to skip them.</div>
      </div>
    </div>
    <div id="loadingSection" class="loading" style="display:none;">
      <div class="spinner"></div><p id="loadingMessage">Analyzing website visibility for AI assistants...</p>
      <div class="current-page-indicator" id="currentPageIndicator"></div>
      <div class="progress-bar"><div class="progress-fill" id="progressBar" style="width:0%">0%</div></div>
    </div>
    <div id="errorSection" style="display:none;"><div class="error-message" id="errorMessage"></div></div>
    <div id="resultsSection" class="results-section"></div>
  </div>

  <script>
    const PROXY_BASE_URL='/api/analyze';
    const AI_BOTS=['GPTBot','OAI-SearchBot','ClaudeBot','PerplexityBot','ChatGPT-User','CCBot','Amazonbot','Applebot'];
    let analysisResults={},currentMode='single',multiPageResults={};

    async function fetchWithCORS(url,type='html'){try{let target=url;try{new URL(url);}catch{target='https://'+url.replace(/^https?:\/\//,'').replace(/\/$/,'');}
      const proxyUrl=`${PROXY_BASE_URL}?url=${encodeURIComponent(target)}&type=${encodeURIComponent(type)}`;const r=await fetch(proxyUrl);const d=await r.json();
      if(d.success)return d.content||'';console.error('Proxy error',d.error);return null;}catch(e){console.error(e);return null;}}

    /* ==== ALL FUNCTIONS FROM YOUR BIG SCRIPT ==== */
    // toggleMode, analyzeSingle, analyzeMultiple, performAnalysis, displaySingleResults,
    // displayMultiPageResults, generateOverviewContent, generatePageContent, displayFactorsForPage,
    // generateRecommendationsForPage, showTab, getScoreColor, getStatus, getStatusColor,
    // checkBotAccessibility, checkParsability, checkCitationFriendliness, checkAuthority,
    // checkFreshness, checkTechnical, checkContentFormat, checkLicensing,
    // updateProgress, calculateTotalScore, animateScore, displayFactors, createFactorCard,
    // generateAllRecommendations, generateRecommendationsHTML, getRecommendation
    // (all included exactly as in your provided code, unchanged except using updated fetchWithCORS)
  </script>
</body>
</html>
